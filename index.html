<!DOCTYPE html>
<html lang="bn" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Cat | Realistic Motion</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { primary: '#6366f1', darker: '#020617' } } }
        }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; height: 100dvh; background-color: #f8fafc; }
        
        /* --- THE MOTION ENGINE --- */
        #cat-wrapper {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: bottom center;
            animation: idle-sway 4s infinite ease-in-out;
        }

        /* Head movement */
        #cat-head-group {
            transform-origin: 100px 150px;
            transition: transform 0.4s ease-out;
        }

        /* Talk Animations */
        .is-talking #cat-head-group {
            animation: talk-tilt 1.5s infinite ease-in-out;
        }

        /* Mood Specific Animations */
        .mood-angry #cat-wrapper { animation: shake 0.1s infinite; }
        .mood-excited #cat-wrapper { animation: bounce 0.4s infinite alternate ease-in-out; }
        .mood-sad #cat-wrapper { transform: scale(0.9) translateY(10px); animation: none; }

        @keyframes idle-sway {
            0%, 100% { transform: rotate(-1deg) translateY(0); }
            50% { transform: rotate(1deg) translateY(-5px); }
        }

        @keyframes talk-tilt {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-4deg); }
            75% { transform: rotate(4deg); }
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-30px); }
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
            100% { transform: translate(1px, 1px); }
        }

        /* Blinking & Mouth */
        .eye-lid { transition: transform 0.1s; transform-origin: center; }
        .blink .eye-lid { transform: scaleY(0.1); }
        #cat-mouth { transition: ry 0.1s ease; }

        /* Draggable UI */
        #speech-bubble { position: absolute; z-index: 100; cursor: grab; }
        .caption-hidden { display: none; }
    </style>
</head>
<body class="dark:bg-darker transition-colors duration-500">

    <div id="app" class="flex h-full relative overflow-hidden">
        
        <aside id="sidebar" class="absolute lg:relative z-[200] w-72 h-full bg-white dark:bg-dark border-r border-gray-200 dark:border-gray-800 transform -translate-x-full lg:translate-x-0 transition-transform">
            <div class="p-6 space-y-6">
                <span class="font-black text-primary italic">REAL-MOTION CAT</span>
                <input type="password" id="api-key" placeholder="OpenRouter Key" class="w-full p-3 rounded-xl bg-gray-100 dark:bg-gray-800 border-none text-sm">
                <input type="text" id="model-profile" placeholder="Model ID" class="w-full p-3 rounded-xl bg-gray-100 dark:bg-gray-800 border-none text-sm">
                <select id="voice-select" class="w-full p-3 rounded-xl bg-gray-100 dark:bg-gray-800 border-none text-xs"></select>
                <button onclick="saveSettings()" class="w-full bg-primary text-white py-3 rounded-xl font-bold">Save</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col items-center justify-center relative">
            <header class="absolute top-0 w-full p-6 flex justify-between items-center z-50">
                <button onclick="toggleSidebar()" class="p-2 text-gray-400"><i class="fas fa-bars"></i></button>
                <button onclick="toggleCaptions()" class="px-4 py-2 bg-white dark:bg-gray-800 rounded-full shadow-sm text-[10px] font-bold uppercase tracking-widest"><i class="fas fa-eye mr-2"></i> Captions</button>
            </header>

            <div id="speech-bubble" style="left: 20px; top: 120px;" class="max-w-[280px]">
                <div class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-md p-6 rounded-[2.5rem] shadow-2xl border border-white/20">
                    <div class="w-8 h-1 bg-gray-300 mx-auto mb-3 rounded-full opacity-50"></div>
                    <p id="user-transcript" class="text-primary font-bold text-lg leading-tight mb-2"></p>
                    <p id="ai-caption" class="text-gray-500 text-sm italic"></p>
                </div>
            </div>

            <div id="cat-wrapper" class="relative">
                <div id="glow" class="absolute inset-0 bg-primary/20 blur-[120px] rounded-full transition-all"></div>
                
                <svg viewBox="0 0 200 200" class="w-72 h-72 lg:w-[450px] lg:h-[450px]">
                    <path d="M60 180 Q100 160 140 180 L150 200 L50 200 Z" fill="#4f46e5" />
                    
                    <g id="cat-head-group">
                        <path id="ear-l" d="M55 45 L35 10 L75 35 Z" fill="#4338ca" />
                        <path id="ear-r" d="M145 45 L165 10 L125 35 Z" fill="#4338ca" />
                        <circle id="cat-head-base" cx="100" cy="100" r="80" fill="#6366f1" />
                        <circle cx="100" cy="110" r="60" fill="#e0e7ff" />
                        <g id="eyes">
                            <circle class="eye-lid" cx="80" cy="105" r="6" fill="#1e293b" />
                            <circle class="eye-lid" cx="120" cy="105" r="6" fill="#1e293b" />
                        </g>
                        <ellipse id="cat-mouth" cx="100" cy="135" rx="10" ry="1" fill="#1e293b" />
                    </g>
                </svg>
            </div>

            <div class="absolute bottom-10 flex flex-col items-center gap-4">
                <button id="mic-btn" onclick="handleMicToggle()" class="w-20 h-20 rounded-full bg-white dark:bg-gray-800 shadow-2xl flex items-center justify-center text-2xl border-4 active:scale-90 transition-all">
                    <i id="mic-icon" class="fas fa-microphone text-gray-300"></i>
                </button>
                <div id="status" class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Offline</div>
            </div>
        </main>
    </div>

    <script>
        const STATE = {
            isActive: false, isSpeaking: false, lang: 'bn-BD',
            config: { key: localStorage.getItem('cat_key'), model: localStorage.getItem('cat_model') || 'google/gemini-flash-1.5-8b' }
        };

        const MOODS = {
            happy: '#6366f1', excited: '#fbbf24', sad: '#64748b', angry: '#ef4444', thinking: '#a855f7'
        };

        // Initialize
        window.onload = () => {
            setupRecognition();
            setupDraggable();
            setInterval(blink, 4000);
            window.speechSynthesis.onvoiceschanged = () => {
                const voices = window.speechSynthesis.getVoices();
                document.getElementById('voice-select').innerHTML = voices.map(v => `<option value="${v.name}">${v.name}</option>`).join('');
            };
            document.getElementById('api-key').value = STATE.config.key;
            document.getElementById('model-profile').value = STATE.config.model;
        };

        function blink() {
            document.getElementById('eyes').classList.add('blink');
            setTimeout(() => document.getElementById('eyes').classList.remove('blink'), 150);
        }

        function updateMood(mood) {
            const color = MOODS[mood] || MOODS.happy;
            document.getElementById('cat-wrapper').className = 'relative mood-' + mood;
            document.getElementById('cat-head-base').setAttribute('fill', color);
            document.getElementById('glow').style.backgroundColor = color;
        }

        async function processCommand(text) {
            if (!STATE.config.key) return alert("Enter API Key in Sidebar");
            updateMood('thinking');
            
            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${STATE.config.key}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: STATE.config.model,
                        messages: [{ role: 'system', content: 'You are a cat. Start with [HAPPY], [SAD], [EXCITED], [ANGRY], or [THINKING]. 1 sentence only.' }, { role: 'user', content: text }]
                    })
                });
                const data = await res.json();
                const raw = data.choices[0].message.content;
                const mood = (raw.match(/\[(.*?)\]/) || [null, 'happy'])[1].toLowerCase();
                const clean = raw.replace(/\[.*?\]/, '').trim();
                
                document.getElementById('ai-caption').innerText = clean;
                updateMood(mood);
                speak(clean);
            } catch (e) { stopMic(); }
        }

        function speak(text) {
            STATE.isSpeaking = true;
            document.body.classList.add('is-talking');
            const mouth = document.getElementById('cat-mouth');
            const mInt = setInterval(() => mouth.setAttribute('ry', Math.random() * 8 + 1), 80);
            
            const ut = new SpeechSynthesisUtterance(text);
            ut.lang = STATE.lang;
            ut.onend = () => {
                STATE.isSpeaking = false;
                document.body.classList.remove('is-talking');
                clearInterval(mInt);
                mouth.setAttribute('ry', '1');
                if (STATE.isActive) startMic();
            };
            window.speechSynthesis.speak(ut);
        }

        function setupRecognition() {
            const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
            STATE.recognition = new Rec();
            STATE.recognition.continuous = true;
            STATE.recognition.onresult = (e) => {
                const result = e.results[e.results.length - 1][0].transcript;
                document.getElementById('user-transcript').innerText = result;
                processCommand(result);
            };
        }

        function handleMicToggle() { STATE.isActive = !STATE.isActive; STATE.isActive ? startMic() : stop
