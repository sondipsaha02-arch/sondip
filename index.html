<!DOCTYPE html>
<html lang="bn" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Cat | Touch Emotion Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { primary: '#6366f1', dark: '#0f172a' } } }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; height: 100dvh; background: #f8fafc; touch-action: manipulation; }
        
        #sidebar { transition: transform 0.3s ease; z-index: 1000; }
        #overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 900; }

        /* --- TOUCH ANIMATIONS --- */
        #cat-stage { transform-origin: bottom center; animation: idle 4s infinite ease-in-out; }
        
        /* Purring effect */
        .is-purring { animation: purr 0.1s infinite !important; }
        @keyframes purr { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } }

        /* Ear Reactions */
        .ears-down #ear-l { transform: rotate(-30deg) translateY(5px); }
        .ears-down #ear-r { transform: rotate(30deg) translateY(5px); }

        #head-group { transform-origin: 100px 145px; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; }
        .is-talking #head-group { animation: talk 1.2s infinite ease-in-out; }
        
        @keyframes idle { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02) translateY(-5px); } }
        @keyframes talk { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }

        /* Draggable Box */
        #speech-bubble { position: absolute; z-index: 100; touch-action: none; width: 85vw; max-width: 300px; }
        .eye-lid { transform-origin: center; transition: transform 0.1s; }
        .blink .eye-lid { transform: scaleY(0.1); }
        .happy-eyes .eye-lid { transform: scaleY(0.4) translateY(4px); }
    </style>
</head>
<body class="dark:bg-dark transition-colors duration-500">

    <div id="overlay" onclick="toggleSidebar()"></div>

    <div id="app" class="flex h-full relative overflow-hidden">
        
        <aside id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-white dark:bg-slate-900 shadow-2xl transform -translate-x-full">
            <div class="p-6 h-full flex flex-col">
                <div class="flex justify-between items-center mb-8">
                    <span class="font-black text-primary text-xl tracking-tighter italic">CAT EMOTION</span>
                    <button onclick="toggleSidebar()" class="p-2 text-gray-400"><i class="fas fa-times"></i></button>
                </div>
                <div class="space-y-4 flex-1">
                    <input type="password" id="api-key" placeholder="API Key" class="w-full p-3 rounded-xl bg-gray-100 dark:bg-gray-800 border-none text-sm">
                    <input type="text" id="model-profile" placeholder="Model ID" class="w-full p-3 rounded-xl bg-gray-100 dark:bg-gray-800 border-none text-sm">
                    <select id="voice-select" class="w-full p-3 rounded-xl bg-gray-100 dark:bg-gray-800 border-none text-xs"></select>
                </div>
                <button onclick="saveSettings()" class="w-full bg-primary text-white py-4 rounded-2xl font-bold">Save Settings</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative">
            <header class="h-16 flex items-center justify-between px-6 z-50">
                <button onclick="toggleSidebar()" class="p-2 bg-white dark:bg-gray-800 shadow rounded-lg text-primary"><i class="fas fa-paw"></i></button>
                <div id="mood-text" class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Mood: Neutral</div>
            </header>

            <div class="flex-1 flex flex-col items-center justify-center relative">
                
                <div id="speech-bubble" style="left: 20px; top: 100px;">
                    <div class="bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl p-5 rounded-[2.5rem] shadow-2xl border border-white/20">
                        <div id="drag-handle" class="w-12 h-1 bg-gray-200 mx-auto mb-3 rounded-full cursor-move"></div>
                        <p id="user-transcript" class="text-primary font-bold text-lg mb-1"></p>
                        <p id="ai-caption" class="text-gray-500 text-sm italic"></p>
                    </div>
                </div>

                <div id="cat-stage">
                    <svg viewBox="0 0 200 200" class="w-72 h-72 sm:w-80 sm:h-80 lg:w-[480px] lg:h-[480px]">
                        <path d="M40 190 Q100 160 160 190 L170 200 L30 200 Z" fill="#4f46e5" />
                        <g id="head-group" onclick="handleTouch('head')" ontouchstart="handleTouch('head')">
                            <path id="ear-l" d="M55 45 L35 10 L75 35 Z" fill="#4338ca" onclick="handleTouch('ear')" />
                            <path id="ear-r" d="M145 45 L165 10 L125 35 Z" fill="#4338ca" onclick="handleTouch('ear')" />
                            <circle id="head-base" cx="100" cy="100" r="80" fill="#6366f1" />
                            <circle cx="100" cy="110" r="62" fill="#e0e7ff" />
                            <g id="eyes">
                                <circle class="eye-lid" cx="78" cy="105" r="7" fill="#1e293b" />
                                <circle class="eye-lid" cx="122" cy="105" r="7" fill="#1e293b" />
                            </g>
                            <ellipse id="mouth-path" cx="100" cy="138" rx="12" ry="1" fill="#1e293b" />
                        </g>
                    </svg>
                </div>

                <div class="absolute bottom-10 flex flex-col items-center gap-4">
                    <button id="mic-btn" onclick="handleMicToggle()" class="w-20 h-20 rounded-full bg-white dark:bg-gray-800 shadow-2xl flex items-center justify-center text-2xl active:scale-90 transition-all">
                        <i id="mic-icon" class="fas fa-microphone text-gray-300"></i>
                    </button>
                    <div id="status" class="text-[9px] font-black text-gray-400 uppercase tracking-widest">Ready</div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const STATE = { isActive: false, isTalking: false, config: { key: localStorage.getItem('cat_key') || '', model: localStorage.getItem('cat_model') || 'google/gemini-flash-1.5-8b' } };

        // --- TOUCH EMOTION LOGIC ---
        function handleTouch(part) {
            const cat = document.getElementById('cat-stage');
            const eyes = document.getElementById('eyes');
            const moodText = document.getElementById('mood-text');

            // Haptic Feedback (Vibration)
            if (navigator.vibrate) navigator.vibrate(50);

            if (part === 'head') {
                cat.classList.add('is-purring');
                eyes.classList.add('happy-eyes');
                moodText.innerText = "Mood: Purring â¤ï¸";
                setTimeout(() => {
                    cat.classList.remove('is-purring');
                    eyes.classList.remove('happy-eyes');
                    moodText.innerText = "Mood: Happy";
                }, 2000);
            } else if (part === 'ear') {
                cat.classList.add('ears-down');
                moodText.innerText = "Mood: Annoyed ðŸ’¢";
                setTimeout(() => {
                    cat.classList.remove('ears-down');
                    moodText.innerText = "Mood: Neutral";
                }, 1500);
            }
        }

        // Menu Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const isOpen = sidebar.style.transform === 'translateX(0px)';
            sidebar.style.transform = isOpen ? 'translateX(-100%)' : 'translateX(0px)';
            overlay.style.display = isOpen ? 'none' : 'block';
        }

        // Draggable Logic
        function setupDraggable(el) {
            let posX = 0, posY = 0, initialX, initialY;
            const dragStart = (e) => {
                const event = e.type === "touchstart" ? e.touches[0] : e;
                initialX = event.clientX - posX; initialY = event.clientY - posY;
                if (e.target.id === 'drag-handle' || e.target === el) {
                    document.onmousemove = drag; document.ontouchmove = drag;
                    document.onmouseup = dragEnd; document.ontouchend = dragEnd;
                }
            };
            const drag = (e) => {
                const event = e.type === "touchmove" ? e.touches[0] : e;
                posX = event.clientX - initialX; posY = event.clientY - initialY;
                el.style.transform = `translate3d(${posX}px, ${posY}px, 0)`;
            };
            const dragEnd = () => { document.onmousemove = null; document.ontouchmove = null; };
            el.onmousedown = dragStart; el.ontouchstart = dragStart;
        }

        // Speech Engine
        function setupRecognition() {
            const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
            STATE.recognition = new Rec();
            STATE.recognition.onresult = (e) => {
                const res = e.results[0][0].transcript;
                document.getElementById('user-transcript').innerText = res;
                processCommand(res);
            };
        }

        async function processCommand(text) {
            if (!STATE.config.key) return alert("API Key Missing");
            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${STATE.config.key}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: STATE.config.model, messages: [{ role: 'system', content: 'You are a cat. 1 short sentence answer.' }, { role: 'user', content: text }] })
                });
                const data = await res.json();
                const clean = data.choices[0].message.content;
                document.getElementById('ai-caption').innerText = clean;
                speak(clean);
            } catch (e) { stopMic(); }
        }

        function speak(text) {
            document.body.classList.add('is-talking');
            const mouth = document.getElementById('mouth-path');
            const mInt = setInterval(() => mouth.setAttribute('ry', Math.random() * 8 + 1), 80);
            const ut = new SpeechSynthesisUtterance(text);
            ut.onend = () => {
                document.body.classList.remove('is-talking');
                clearInterval(mInt); mouth.setAttribute('ry', '1');
                if (STATE.isActive) STATE.recognition.start();
            };
            window.speechSynthesis.speak(ut);
        }

        function handleMicToggle() {
            STATE.isActive = !STATE.isActive;
            if (STATE.isActive) {
                STATE.recognition.start();
                document.getElementById('mic-icon').className = "fas fa-spinner fa-spin text-primary";
                document.getElementById('status').innerText = "Listening...";
            } else {
                stopMic();
            }
        }

        function stopMic() {
            STATE.recognition.stop();
            document.getElementById('mic-icon').className = "fas fa-microphone text-gray-300";
            document.getElementById('status').innerText = "Ready";
        }

        window.onload = () => {
            setupRecognition();
            setupDraggable(document.getElementById('speech-bubble'));
            setInterval(() => {
                const eyes = document.getElementById('eyes');
                eyes.classList.add('blink');
                setTimeout(() => eyes.classList.remove('blink'), 150);
            }, 4000);
            document.getElementById('api-key').value = STATE.config.key;
            document.getElementById('model-profile').value = STATE.config.model;
        };

        function saveSettings() {
            STATE.config.key = document.getElementById('api-key').value;
            STATE.config.model = document.getElementById('model-profile').value;
            localStorage.setItem('cat_key', STATE.config.key);
            localStorage.setItem('cat_model', STATE.config.model);
            toggleSidebar();
        }
    </script>
</body>
</html>
